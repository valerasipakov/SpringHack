## Навигация по readme
1. [ЗАДАНИЕ](#задание)  
2. [ПРОБЛЕМАТИКА](#проблема)  
3. [ОЖИДАЕМЫЙ РЕЗУЛЬТАТ](#ожидания)  
4. [ТРЕБОВАНИЯ К РЕЗУЛЬТАТУ](#требования)  
5. [РЕЗУЛЬТАТ РАЗРАБОТКИ](#результат)  
	5.1. [ИНСТРУКЦИЯ ДЛЯ УСТАНОВКИ И ЗАПУСКА ПРОЕКТА](#инструкция)  
		5.1.1. [УСТАНОВКА ПРОЕКТА](#установка)  
		5.1.2. [ТЕСТОВЫЙ ЗАПУСК](#тест_запуск)  
		5.1.3. [ФАЙЛЫ ПРОЕКТА](#файлы)  
		5.1.4. [РАБОТА С ОТДЕЛЬНЫМИ СКРИПТАМИ ЧЕРЕЗ ТЕРМИНАЛ](#терминал)  
		5.1.5. [GUI ИНТЕРФЕЙС ПОЛЬЗОВАТЕЛЯ](#интерфейс)  
	5.2. [КЛЮЧЕВЫЕ ИДЕИ/ФИШКИ РЕАЛИЗАЦИИ ПРОЕКТА](#фишки)  

#### Ссылка на видео с описанием работы приложения: https://drive.google.com/file/d/17da3XxDLXVUJIsqhRpmzr7oW9M1lJ8vI/view?usp=sharing

## 1. Задание № 2 <a name="задание"></a>

Парсер для базы данных (БД).
* * * 

## 2. Проблематика <a name="проблема"></a>

Насыщение баз данных, содержащих информацию о комплектующих беспилотных летающих аппаратов(БПЛА) в настоящее время осуществляется  
в ручном режиме.
* * *

## 3. Ожидаемый результат <a name="ожидания"></a>

В ходе хакатона командам предстоит разработать универсальный парсер для автоматического наполнения базы данных комплектующих БПЛА.
* * *

## 4. Требования к результату <a name="требования"></a>

- входными данными парсера является перечень сайтов, с которых будет собираться информация (преимуществом будет наличие возможности  
  работы и с другими сайтами);
- перечень сайтов (https://aeromotus.ru, https://nelk.ru, https://dji.com/ru/dji-fpv/specs, https://geobox.ru);
- при новых итерациях работы парсера таблица с выходными данными должна обновляться и автоматически отображать изменения;
- выходные данные должны быть представлены в таблице формата .xlsx.;
- в таблице для каждого товара необходимо указать имя файла его изображения (без расширения) и ссылку, по которой он был найден;
- в целях проверки работоспособности кода в директории проекта должен находиться файл README.md с описанием  
  процесса запуска разработанного модуля в тестовой среде.  
* * *


## 5. Результат разработки <a name="результат"></a>

Представляем вниманию читателя проект-приложение парсера для баз данных, содержащих информацию о комплектующих БПЛА.  
Данное программное решение ориентировано на универсализацию процесса поиска заданных категорий товаров и их характеристик не  
только на указанном в требованиях перечне сайтов, но и для случайных сайтов комплектующих БПЛА. В перспективе  
предусмотрены возможности усовершенствования алгоритма работы путем наращивания и видоизменения структуры входных данных.  


### 5.1. Инструкция для установки и запуска проекта <a name="инструкция"></a>

#### 5.1.1. Установка проекта <a name="установка"></a>
Для установки вам потребуется установленный python версии 3.10 и выше, а так же установленный пакетный менеджер pip. Для сборки  
проекта запустите терминал в директории проекта и выполните следующие команды:
1. `python -m venv venv`
2. `venv\Scripts\activate`
3. `pip install -r requirements.txt`

Так же нужно проделать следующую последовательность действий:
1. Открыть панель управления
2. Ввести путь "Панель управления\Все элементы панели управления\Система"
3. Нажать Дополнительные параметры системы
4. В открывшемся окне нажать "Переменные среды"
5. Затем нажать кнопку создать
6. В поле имя переменной ввести "QT_PLUGIN_PATH"
7. В поле значение переменной ввести следующий путь:  
`C:\Users\user_name\AppData\Local\Programs\Python\Python310\Lib\site-packages\PyQt5\Qt5\plugins`  
(вместо user_name нужно установить имя пользователя, в аккаунте которого запускается проект, также возможно, что версия Python  
будет отличаться).

Эти действия необходимы для избежания непредвиденного поведения программы.

Теперь осталось из консоли запустить скрипт в виртуальной среде venv `python gui.py` и наслаждаться работой программы :)

#### 5.1.2. Тестовый запуск <a name="тест_запуск"></a>
Для проверки работоспособности программы нужно создать файл в папке проекта websites.txt и в него вставить следующий  
сайт (https://idronex.ru), далее запустить графический интерфейс (пример запуска приводился выше) и выбрать файл websites.txt.  
Теперь можно выбрать одно из трех действий в GUI.

#### 5.1.3. Файлы проекта <a name="файлы"></a>
Наш проект предоставляет пользователю 3 основные функции, с корорыми можно работать как через удобный графический интерфейс,  
так и через командную строку.

***Основные возможности приложения:***
1. _Скачивание сайта_: полная загрузка сайта (или сайтов) на компьютер для последующей работы с ними (сбор характеристик  
товаров в excel таблицу)
2. _Анализ загруженных файлов_: создание json файла (сохраняется в папку data), в котором содержатся все характеристики по  
каждому комкретному товару. Далее этот json следует конвертировать в excel таблицу  
3. _Конвертация в Excel-таблицу_: создает из json файла с характеристиками excel таблицу.

#### 5.1.4. Работа с отдельными скриптами через терминал <a name="терминал"></a>

##### - ***update_synonyms.py*** -
Добавляет к уже существующей таблице синонимов (_synonyms.json_) новые данные. После вызова программа запросит название json  
файла, из которого будут браться новые данные (каждый такой файл хранится в папке source/).  
В папке _source/_ лежит файл _example.json_ в котором содержится шаблон, по которому создаются такие файлы.  

##### - ***download_site.json*** -
Полностью скачивает сайт на компьютер. При запуске запросит один параметр - ссылка на сайт (в формате: _https://google.com/_)  
Во время своей работы создает папку с таким же названием как и у сайта, в ней будет лежать еще одна папка с таким же названием  
(в ней уже хранятся все файлы) и 3 технических файла:  
- _proc.json_ - список всех обработанных ссылок
- _queue.json_ - список ссылок, которые на текущий момент находятся в очереди
- _unproc.json_ - список ссылок, по которым не удалось получить положительного ответа (403б 502, 503, ..., но не 200)

##### - ***parse_site.py*** -
Обрабатывает загруженные сайты и создает итоговый json (_хранится в папке data/_), который представляет из себя список с  
объектами, каждый из которых описывает товар

##### - ***json_to_xlsx_converter.py*** -
На вход данного модуля программы поступает json-файл, полученный при парсинге сайтов. Затем создается xlsx-файл, в котором  
создаются excel-листы для каждого типа товара, после чего все товары, занесенные в json-файл, переносятся в excel таблицу.  

#### 5.1.5. GUI Интерфес пользователя <a name="интерфейс"></a>

***Описание:***  
В оконном приложении есть 4 кнопки вида pushButton:
1. "Выберите файл с перечнем сайтов": при нажатии на эту кнопку открывается проводник, в котором необходимо выбрать файл  
формата .txt, в котором будут записаны ссылки на вебсайт.  
Формат данного файла следующий: каждая ссылка должна быть записана на новой строке.  
После того, как файл будет выбран, в строке под данной кнопкой появится полный путь до указанного файла.  
2. "Выгрузить сайты из списка": при нажатии на эту кнопку сначала производится проверка на корректность введенных сайтов,  
после чего начнется загрузка файлов сайта. Логи по загрузке файла можно увидеть в консоли.  
3. "Парсинг загруженных сайтов": запуск скриптов из файла download_site.py. Необходимо дождаться завершения работы.  
4. "Получить таблицу Excel": есть два варианта работы этой программы:  
        1. Если нажата radioButton "Выбрать ранние версии", то пользователю будет предоставлена возможность выбрать, какую  
           версию файла json он хочет преобразовать. Все допустимые файлы json хранятся в папке data и имеют ПРЕФИКС catalog_v.  
        2. В случае если нажата "Последняя версия", то будет создан excel документ для самой новой версии парсинга.  
В результате работы получится excel документ, в котором все категории товаров разбиты по листам.  

ЗАМЕЧАНИЕ: для работы с кнопками 2 и 3 обязательно нужно выбрать файл из пункта 1.


### 5.2. Ключевые идеи/фишки реализации проекта <a name="фишки"></a>

- [x]*Полноценная первичная выгрузка данных с сайта.*  

Осуществляем полную выгрузку информации с сайта, отказавшись от структурного поиска через карту сайта (sitemap.xml) в силу  
частого отсутствия упорядоченности и строгой организации html-файлов, единой логики распределения информации по сайтам  
у разных производителей/поставщиков/ритейлеров.  
Нужная нам информация о товарах и характеристиках может содержаться в любой неочевидной части/модуле/подстранице сайта,  
в связи с чем было принято решение полноценно считывать все возможные данные для дальнейшей дифференциации и последующего  
анализа.  

- [x]*Возможность расширять перечень товаров и категорий. Уточнение поиска.*

Входными данными, включающими в себя перечень категорий товаров и их характеристик, являются json-файлы (файлы-словари),  
имеющие определенную структуру, заточенную на задачу поиска конкретных данных. Для наращивания обЪема искомых данных  
предусмотрена возможность увеличивать число json-фалов и автоматически генерировать обощенный json. Причем в новые  
подгружаемые json-ы можно добавлять как новые категории, так и слова синонимы для более точного определения характеристик  
и самих названий товаров. Как итог, программа имеет потенциал расширять возможности парсинга и адаптировать его под запросы  
конкретных данных, например, поиск по англоязычной терминологии (в json словарь синонимов также прописываются английские  
названия товаров и характеристик).


- [x]*Полная перевыгрузка данных при добавлении новой информации о товарах на сайте.*  

Создание локальной копии данных с сайтов связано с решением уйти от проблемы перегрузки удаленного сервера конкретного сайта  
и обхода банов. Если на сайте появится новая информация по товарам или новые характеристики, пользователю доступна возможность  
обновить базу данных путем повторного полноценного считывания информации. Если же пользователь хочет добавить какие-то новые  
параметры или характеристики, которых до этого момента не было в файлах json, то стоит подгрузить новые json-файлы и провести  
парсинг по уже имеющейся локальной копии сайтов.

- [x]*Дифференциация товаров по категориям*  

Для данной задачи был разработан классификатор для однозначного определения категорий товара при схожести наименований  
характеристик у разных товаров на одном и том же сайте. Json-словарь слов синонимов для категорий составлен опытным путем,  
опираясь на информацию из конкретных сайтов(есть возможность дополнять/полностью обновлять словарь).  
За основу вычисления принадлежности к тому или иному типу товароа взято процентное отношение.  

Расчетная формута: **(M : S) * 100%**, где  
**M** - максимальное число характеристик,  
**S** - число совпадений характеристик.  

Т.е. общее число характеристик для типа товара, делим на количество найденных совпадений этих характеристик с сайта, и  
домножаем на 100%. Если на сайте встречается более 70% характеристик из максимально возможных для конкретного типа товара,  
то с уверенностью определяем категорию товара.  
* * *
* * *

***Разработано в МЭИ***  
***Made in MPEI***  